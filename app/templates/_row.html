<tr data-id="{{ r.id }}">
  <td class="mono">{{ r.id }}</td>
  <td>{{ r.client }}</td>
  <td class="mono">{{ r.client_key }}</td>
  <td>{{ r.start_iso|timeonly }}</td>
  <td>{{ r.end_iso|timeonly }}</td>
  <td class="mono">{{ r.rounded_minutes }}</td>
  <td class="mono">{{ r.rounded_hours|hours2d }}</td>

  <td class="mono">{{ r.hardware_sales_price or r.flat_rate_amount or '' }}</td>

  <td class="note">
    {% if r.entry_type == 'hardware' %}
      <div class="note-cell">
        <div class="note-preview"><strong>{{ r.hardware_description or '(no description)' }}</strong></div>
      </div>
    {% elif r.entry_type == 'deployment_flat_rate' %}
      <div class="note-cell">
        <div class="note-preview"><strong>Deployment Flat Rate · Qty {{ r.flat_rate_quantity or 1 }} @ {{ r.flat_rate_amount or '—' }}</strong>{% if r.note %} — {{ r.note }}{% endif %}</div>
      </div>
    {% else %}
      <div class="note-cell {% if r.note %}collapsed{% endif %}">
        {% if r.note %}
        <button class="note-toggle" type="button" aria-label="Expand note" aria-expanded="false"></button>
        {% endif %}
        <div class="note-preview">{{ r.note or "" }}</div>
      </div>
    {% endif %}
  </td>

  <td>
    <form class="invoice-form">
      <input name="invoice_number" value="{{ r.invoice_number or '' }}" placeholder="e.g. INV-2025-001" />
    </form>
  </td>

  <td class="action">
    <button class="pill {{ 'ok' if r.completed else '' }} js-toggle" title="Toggle Added to QB">{{ 'Added to QB' if r.completed else 'Open' }}</button>
    <button class="icon danger js-del" title="Delete">✕</button>
  </td>
</tr>
